/***************************************************************************
 * STM32 VGA demo
 * Copyright (C) 2012 Artekit Italy
 * http://www.artekit.eu
 * Written by Ruben H. Meleca
 
### main.c
 
#   This program is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation; either version 2 of the License, or
#   (at your option) any later version.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program; if not, write to the Free Software
#   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

***************************************************************************/

#include "stm32f10x.h"
#include "sys.h"
#include "video.h"
#include "gdi.h"

extern void demoInit(void);

void RCC_Configuration(void)
{
	/* TIM1, GPIOA, GPIOB, GPIOE and AFIO clocks enable */
	RCC_AHBPeriphClockCmd(RCC_AHBPeriph_DMA1, ENABLE);
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1 | RCC_APB2Periph_SPI1 | RCC_APB2Periph_TIM1 | RCC_APB2Periph_GPIOA |
							RCC_APB2Periph_GPIOB | RCC_APB2Periph_AFIO, ENABLE);
	RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2, ENABLE);
}

void GPIO_Configuration(void)
{

}

extern u8 fb[VID_VSIZE][VID_HSIZE+2];

const unsigned char logo[1680] = { /* 0X00,0X01,0XF0,0X00,0X38,0X00, */
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFC,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFC,0X00,0X00,0X00,
0X00,0X00,0X1F,0X00,0X07,0XF0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X0F,0XFF,0X80,0X00,0X00,0X00,0X00,0X0C,0X00,0X00,0X00,0X00,0X00,
0X1F,0X00,0X07,0XF0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X0F,0XFF,0X80,0X00,0X00,0X00,0X00,0X08,0X00,0X00,0X00,0X00,0X00,0X05,0X00,
0X0D,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X40,0X00,0X00,0X00,0X00,0X00,0X08,0X00,0X00,0X00,0X00,0X00,0X05,0X80,0X09,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XC0,0X00,
0X00,0X00,0X00,0X00,0X18,0X00,0X00,0X00,0X00,0X00,0X0D,0X80,0X13,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XC0,0X00,0X00,0X00,
0X00,0X00,0X18,0X00,0X00,0X00,0X00,0X00,0X0C,0X80,0X33,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X80,0X00,0X00,0X00,0X00,0X00,
0X10,0X00,0X00,0X00,0X00,0X00,0X08,0X80,0X22,0X07,0XE0,0X1F,0X80,0X00,0X7E,0X20,
0X00,0X0F,0X80,0X00,0X00,0X00,0X00,0X00,0X80,0X00,0X00,0X07,0X80,0X00,0X10,0X3C,
0X00,0X00,0X00,0X00,0X08,0XC0,0X42,0X07,0XE0,0X1F,0X80,0X03,0XFF,0XE0,0X00,0X7F,
0XF0,0X00,0X00,0X00,0X00,0X00,0X80,0X00,0X00,0XFF,0XE0,0X00,0X11,0XFF,0X80,0X00,
0X00,0X00,0X08,0XC0,0XC2,0X00,0X60,0X01,0X80,0X06,0X00,0XE0,0X00,0XC0,0X38,0X00,
0X00,0X00,0X00,0X01,0X80,0X00,0X01,0X80,0X30,0X00,0X33,0X01,0XC0,0X00,0X00,0X00,
0X18,0XC0,0X86,0X00,0X60,0X01,0X80,0X0C,0X00,0X60,0X03,0X00,0X1C,0X00,0X00,0X00,
0X00,0X01,0X80,0X00,0X00,0X00,0X18,0X00,0X3C,0X00,0XE0,0X00,0X00,0X00,0X18,0X41,
0X06,0X00,0X40,0X01,0X00,0X08,0X00,0X60,0X04,0X00,0X0C,0X00,0X00,0X00,0X00,0X01,
0X00,0X00,0X00,0X00,0X18,0X00,0X38,0X00,0X60,0X00,0X00,0X00,0X10,0X43,0X04,0X00,
0X40,0X01,0X00,0X18,0X00,0X40,0X08,0X00,0X04,0X00,0X00,0X00,0X00,0X01,0X00,0X00,
0X00,0X00,0X18,0X00,0X30,0X00,0X20,0X00,0X00,0X00,0X10,0X62,0X04,0X00,0XC0,0X03,
0X00,0X18,0X00,0X00,0X08,0X00,0X06,0X00,0X00,0X00,0X00,0X03,0X00,0X00,0X00,0X00,
0X18,0X00,0X60,0X00,0X30,0X00,0X00,0X00,0X10,0X66,0X04,0X00,0XC0,0X03,0X00,0X0C,
0X00,0X00,0X10,0X00,0X06,0X00,0X00,0X00,0X00,0X03,0X00,0X00,0X00,0X00,0X10,0X00,
0X60,0X00,0X30,0X00,0X00,0X00,0X30,0X24,0X0C,0X00,0X80,0X02,0X00,0X07,0XC0,0X00,
0X1F,0XFF,0XFE,0X00,0X00,0X00,0X00,0X02,0X00,0X00,0X00,0X3E,0X10,0X00,0X40,0X00,
0X30,0X00,0X00,0X00,0X30,0X38,0X0C,0X00,0X80,0X02,0X00,0X00,0XFE,0X00,0X1F,0XFF,
0XFE,0X00,0X00,0X00,0X00,0X02,0X00,0X00,0X01,0XFF,0XF0,0X00,0X40,0X00,0X30,0X00,
0X00,0X00,0X20,0X38,0X0C,0X01,0X80,0X06,0X00,0X00,0X03,0X80,0X30,0X00,0X00,0X00,
0X00,0X00,0X00,0X06,0X00,0X18,0X07,0X00,0X70,0X00,0XC0,0X00,0X20,0X00,0X00,0X00,
0X20,0X30,0X08,0X01,0X80,0X06,0X00,0X00,0X01,0X80,0X30,0X00,0X00,0X00,0X00,0X00,
0X00,0X06,0X00,0X18,0X0C,0X00,0X20,0X00,0X80,0X00,0X20,0X00,0X00,0X00,0X20,0X00,
0X08,0X01,0X00,0X04,0X00,0X00,0X00,0XC0,0X30,0X00,0X00,0X00,0X00,0X00,0X00,0X04,
0X00,0X10,0X18,0X00,0X20,0X00,0X80,0X00,0X60,0X00,0X00,0X00,0X20,0X00,0X08,0X01,
0X00,0X04,0X00,0X00,0X00,0XC0,0X30,0X00,0X00,0X00,0X00,0X00,0X00,0X04,0X00,0X10,
0X10,0X00,0X60,0X00,0XC0,0X00,0X40,0X00,0X00,0X00,0X60,0X00,0X18,0X03,0X00,0X04,
0X00,0X40,0X00,0XC0,0X10,0X00,0X00,0X00,0X00,0X00,0X00,0X04,0X00,0X30,0X30,0X00,
0X60,0X00,0XC0,0X00,0X80,0X00,0X00,0X00,0X60,0X00,0X18,0X03,0X00,0X0C,0X00,0XC0,
0X01,0X80,0X18,0X00,0X00,0X00,0X00,0X00,0X00,0X0C,0X00,0X30,0X30,0X00,0X40,0X01,
0XC0,0X01,0X80,0X00,0X00,0X00,0X40,0X00,0X10,0X03,0X00,0X3C,0X00,0XC0,0X03,0X00,
0X0C,0X00,0X1C,0X00,0X00,0X00,0X00,0X0C,0X00,0X20,0X30,0X01,0XC0,0X01,0XE0,0X07,
0X00,0X00,0X00,0X00,0X40,0X00,0X10,0X03,0X80,0XE8,0X00,0XF0,0X06,0X00,0X07,0X00,
0XF0,0X00,0X00,0X00,0X00,0X08,0X00,0X20,0X18,0X0E,0XC0,0X01,0X38,0X0C,0X00,0X00,
0X00,0X0F,0XFC,0X07,0XFE,0X01,0XFF,0X8F,0X01,0XFF,0XFC,0X00,0X03,0XFF,0XC0,0X00,
0X00,0X00,0X03,0XFF,0XFF,0XE0,0X0F,0XF8,0XFC,0X3F,0X1F,0XF8,0X00,0X00,0X00,0X0F,
0XFC,0X07,0XFE,0X00,0X78,0X1F,0X01,0X0F,0XC0,0X00,0X00,0X7C,0X00,0X00,0X00,0X00,
0X03,0XFF,0XFF,0XE0,0X03,0XC0,0XFC,0X3F,0X03,0XC0,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
};


int main(void)
{
	int i, x;
 	RCC_Configuration();
	GPIO_Configuration();

	vidInit();
	sysInitSystemTimer();
	
#if 0	
	for(i = 0; i < VID_VSIZE; i++) {
		for(x = 0; x < VID_HSIZE; x++) {
			if (x < 2) {
				fb[i][x] = 0x55;			
			} else {
				fb[i][x] = 0xff;
			}

		}
	}
	while(1);

	gdiBitBlt(NULL,0, 0, 240,56, (pu8) logo,GDI_ROP_COPY);
	while(1);
#endif
	
	gdiRectangle(0,0,(VID_PIXELS_X - 1),VID_VSIZE - 1,0);
	gdiDrawTextEx(180, 40, "MUSE LAB", GDI_ROP_COPY);
	gdiDrawTextEx(161, 55, "HC6502 PROJECT", GDI_ROP_COPY);
	gdiDrawTextEx(140, 70, "GITHUB.COM/WUXX/HC6502", GDI_ROP_COPY);

	sysDelayMs(5000);

	gdiBitBlt(NULL,0, 0, 240,56, (pu8) logo,GDI_ROP_COPY);
	sysDelayMs(5000);
	
	vidClearScreen();
	
	gdiDrawTextEx(0, 0,   "0000000000", GDI_ROP_COPY);
	gdiDrawTextEx(0, 10,  "1111111111", GDI_ROP_COPY);
	gdiDrawTextEx(0, 20,  "2222222222", GDI_ROP_COPY);
	gdiDrawTextEx(0, 30,  "3333333333", GDI_ROP_COPY);
	gdiDrawTextEx(0, 40,  "4444444444", GDI_ROP_COPY);
	gdiDrawTextEx(0, 50,  "5555555555", GDI_ROP_COPY);
	gdiDrawTextEx(0, 60,  "6666666666", GDI_ROP_COPY);
	gdiDrawTextEx(0, 70,  "7777777777", GDI_ROP_COPY);
	gdiDrawTextEx(0, 80,  "8888888888", GDI_ROP_COPY);
	gdiDrawTextEx(0, 90,  "9999999999", GDI_ROP_COPY);
	gdiDrawTextEx(0, 100, "AAAAAAAAAA", GDI_ROP_COPY);
	gdiDrawTextEx(0, 110, "BBBBBBBBBB", GDI_ROP_COPY);
	gdiDrawTextEx(0, 120, "CCCCCCCCCC", GDI_ROP_COPY);
	gdiDrawTextEx(0, 130, "DDDDDDDDDD", GDI_ROP_COPY);
	gdiDrawTextEx(0, 140, "EEEEEEEEEE", GDI_ROP_COPY);
	gdiDrawTextEx(0, 150, "FFFFFFFFFF", GDI_ROP_COPY);
	gdiDrawTextEx(0, 160, "GGGGGGGGGG", GDI_ROP_COPY);
	gdiDrawTextEx(0, 170, "HHHHHHHHHH", GDI_ROP_COPY);
	gdiDrawTextEx(0, 180, "AAAAAAAAAA", GDI_ROP_COPY);
	gdiDrawTextEx(0, 190, "BBBBBBBBBB", GDI_ROP_COPY);
	
	sysDelayMs(5000);
	
	demoInit();
	
	return 0;
}
